# -*- coding: utf-8 -*-
"""
Created on Sun Oct 30 22:02:00 2022


@author: arman hossain

!python veondor_pie_chart.py
"""

from PyQt5.QtWidgets import QApplication, QMainWindow
import sys
from PyQt5.QtChart import QChart, QChartView, QPieSeries, QPieSlice
from PyQt5.QtGui import QPainter, QPen
from PyQt5.QtCore import Qt
import pickle 
 

 
class Window(QMainWindow):
    def __init__(self):
        super().__init__()
 
        self.setWindowTitle("PyQtChart Pie Chart")
        self.setGeometry(100,100, 1280,600)
 
        self.show()
        # self.read_data("../data/2002-2022-vendor-year-count.pickle")
        # self.create_piechart()

    def total_veulnerability_by_year(self,dict_):
        ''' 
        intended for this dictionary
        
        {
            1999: count,
            1999.5: count,

        }
        
        '''
        total = 0
        for key in dict_:
            total+=dict_[key]
        return total


    def total_veulnerability(self,dict_):
        '''
        intended for this dictionary
        
        {
            microsoft:
                {
                    1999: count,
                    1999.5: count,
                }
            juniper:
                {
                    1999: count,
                    1999.5: count,
                }
        }
        
        '''
        total = 0
        for key in dict_:
            for item in dict_[key]:
                total+=dict_[key][item]
        return total
    
    def create_piechart(self,data_dict,first_n):
        cnt = 0
        total_individual = 0
        series = QPieSeries()
        total = self.total_veulnerability(data_dict)
        for key in data_dict:
            if cnt == first_n: break
            cnt+=1
            individual = self.total_veulnerability_by_year(data_dict[key])
            series.append(key, individual)
            total_individual+=individual
        series.append(str(len(data_dict.keys())-first_n)+" others", total-total_individual)
        
        for i in range(first_n+1):
            #adding slice
            slice = QPieSlice()
            slice = series.slices()[i]
            # slice.setExploded(True)
            slice.setLabelVisible(True)
            # slice.setPen(QPen(Qt.darkGreen, 2))
            # slice.setBrush(Qt.green)
 
 
 
 
        chart = QChart()
        chart.legend().hide()
        chart.addSeries(series)
        chart.createDefaultAxes()
        chart.setAnimationOptions(QChart.SeriesAnimations)
        chart.setTitle("Pie Chart Example")
 
        chart.legend().setVisible(True)
        chart.legend().setAlignment(Qt.AlignBottom)
 
        chartview = QChartView(chart)
        chartview.setRenderHint(QPainter.Antialiasing)
 
        self.setCentralWidget(chartview)
 

if __name__ == "__main__":
    def read_pickle(filename):
        with open(filename, 'rb') as file:
            obj = pickle.load(file)
        # filename = "2002-2022-vendor-year-count.pickle"
        return obj
    data = read_pickle('../data/2002-2022-vendor-year-count.pickle')
    App = QApplication(sys.argv)
    window = Window()
    window.create_piechart(data,5)
    sys.exit(App.exec_())